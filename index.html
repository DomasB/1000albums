<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>1000 albums challange</title>
    <style media="screen">
      #app {
        max-width: 80vw;
        margin: 0 auto;
        min-width: 600px;
      }
      .artist-container {
        display: inline-table;
        width: 16vw;
        height: 16vw;
        min-width: 150px;
        min-height: 150px;
        vertical-align: top;
      }
      .artist-title {
        font-family: 'Krub', sans-serif;
        vertical-align: bottom;
        color: white;
        width: 15vw;
        min-width: 150px;
        position: relative;
        display: table-cell;
        height: 100%;
        padding: 1vw;
        font-size: 100%;
        text-shadow:0px 1px 0 rgb(0,0,0),0px -1px 0 rgb(0,0,0),1px 0px 0 rgb(0,0,0),-1px 0px 0 rgb(0,0,0),1px 1px 0 rgb(0,0,0),1px -1px 0 rgb(0,0,0),-1px 1px 0 rgb(0,0,0),-1px -1px 0 rgb(0,0,0),0px 2px 0 rgb(0,0,0),0px -2px 0 rgb(0,0,0),2px 0px 0 rgb(0,0,0),-2px 0px 0 rgb(0,0,0),2px 2px 0 rgb(0,0,0),2px -2px 0 rgb(0,0,0),-2px 2px 0 rgb(0,0,0),-2px -2px 0 rgb(0,0,0);
      }
      .artist-image {
        display: block;
        width: 16vw;
        height: auto;
        position: absolute;
        min-width: 150px;
        min-height: 150px;
      }
    </style>
    <link href="https://fonts.googleapis.com/css?family=Krub" rel="stylesheet">
  </head>
  <body>
    <div id="app"></div>
<script type="text/javascript">
  let data;
  document.addEventListener('scroll', (e) => {
    let windowHeight = document.getElementById('app').getBoundingClientRect().height;
    let scrollHeight = window.scrollY;
    if (windowHeight - scrollHeight < 1600) {
      let dataToDraw = data.slice(0,40);
      data = data.slice(40)
      drawImage(dataToDraw);
    }
  })
  fetch('data.json')
  .then(r => r.json())
  .then(r => {
    data = r.slice(40);
    drawImage(r.slice(0,40));
  })
  const drawImage = (imageArray) => {
    Promise.all(
      imageArray.map(artist => {
        return fetch(artist.artist_image).then(r => {
          let containerDiv = document.createElement('div');
          containerDiv.classList.add('artist-container');
          let titleDiv = document.createElement('div');
          titleDiv.classList.add('artist-title');
          titleDiv.innerHTML = artist.artist_name;
          let image = document.createElement('img');
          image.src = r.ok ? artist.artist_image : 'empty.png';
          image.classList.add("artist-image");
          containerDiv.appendChild(image);
          containerDiv.appendChild(titleDiv);
          document.getElementById('app').appendChild(containerDiv);
        })
      })
    )
  }

</script>
  </body>
</html>
